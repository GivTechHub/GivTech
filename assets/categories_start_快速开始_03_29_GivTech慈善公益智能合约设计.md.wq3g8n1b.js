import{_ as k}from"./chunks/ArticleMetadata.VODzFXfv.js";import{_ as p,D as e,o as n,c as r,I as d,w as g,k as t,a as C,R as y,b as A,e as c}from"./chunks/framework.FVQzxbLi.js";import"./chunks/md5.RtphNWHi.js";const f=JSON.parse('{"title":"GivTech慈善公益智能合约设计","description":"","frontmatter":{"title":"GivTech慈善公益智能合约设计","author":"张宇豪","date":"2024/3/29 20:00","categories":["Solidity"],"tags":["Solidity"]},"headers":[],"relativePath":"categories/start/快速开始/03/29/GivTech慈善公益智能合约设计.md","filePath":"categories/start/快速开始/03/29/GivTech慈善公益智能合约设计.md","lastUpdated":1711635986000}'),o={name:"categories/start/快速开始/03/29/GivTech慈善公益智能合约设计.md"},D=t("h1",{id:"慈善公益智能合约设计",tabindex:"-1"},[C("慈善公益智能合约设计 "),t("a",{class:"header-anchor",href:"#慈善公益智能合约设计","aria-label":'Permalink to "慈善公益智能合约设计"'},"​")],-1),F=y(`<h2 id="_1-合约业务架构图" tabindex="-1">1.合约业务架构图 <a class="header-anchor" href="#_1-合约业务架构图" aria-label="Permalink to &quot;1.合约业务架构图&quot;">​</a></h2><ul><li>主要合约是： <strong>CharityController</strong></li><li>慈善公益业务合约：<strong>CharityService</strong></li><li>用户业务合约：<strong>UserService</strong></li><li>捐赠物资溯源上链合约：<strong>CharityTrace</strong></li><li>捐赠资金溯源上链合约：<strong>DonationTrace</strong></li><li>角色权限管理合约：<strong>RoleAuth</strong></li></ul><p><img src="https://yw742c34bos.feishu.cn/space/api/box/stream/download/asynccode/?code=Y2Q0ZTdiOTk4N2UwNjM3ZTNmYmI2ZWZjNDIwNDVkZmFfMzVpTGtBbWdiamlNVlBGV3lkcmE0VmFkcmI4ZnVsd1hfVG9rZW46VUpyQ2JpZ2Jvb2NJZFB4OGVDYmM1UUl6bjNkXzE3MTE2Mjk0ODg6MTcxMTYzMzA4OF9WNA" alt="img"></p><h2 id="_2-合约用例图设计" tabindex="-1">2.合约用例图设计 <a class="header-anchor" href="#_2-合约用例图设计" aria-label="Permalink to &quot;2.合约用例图设计&quot;">​</a></h2><p><img src="https://yw742c34bos.feishu.cn/space/api/box/stream/download/asynccode/?code=M2M4MGQ4ZDNlZTE5M2Q1YWY4ZmQwYWM1ZTcxMmNkMDJfa3kwRFRiQ2ZIandDUnFIbWZ3YUFpWkYyYll4ZDZldHlfVG9rZW46T1hzUmJ6SkFyb2c0cER4SXpMbGNXQTBGbjJmXzE3MTE2Mjk0ODg6MTcxMTYzMzA4OF9WNA" alt="img"></p><h2 id="_3-合约功能设计" tabindex="-1">3.合约功能设计 <a class="header-anchor" href="#_3-合约功能设计" aria-label="Permalink to &quot;3.合约功能设计&quot;">​</a></h2><h2 id="_4-合约数据结构设计" tabindex="-1">4.合约数据结构设计 <a class="header-anchor" href="#_4-合约数据结构设计" aria-label="Permalink to &quot;4.合约数据结构设计&quot;">​</a></h2><h3 id="_1-用户数据存储设计" tabindex="-1">1.用户数据存储设计 <a class="header-anchor" href="#_1-用户数据存储设计" aria-label="Permalink to &quot;1.用户数据存储设计&quot;">​</a></h3><h4 id="_1-1-普通用户数据结构设计" tabindex="-1">1.1 普通用户数据结构设计 <a class="header-anchor" href="#_1-1-普通用户数据结构设计" aria-label="Permalink to &quot;1.1 普通用户数据结构设计&quot;">​</a></h4><div class="language-solidity vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">solidity</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    // 用户结构体信息</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> User</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> userId;              </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 用户ID</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        string</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  userName;            </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 用户名称</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        address</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> userAddress;         </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 用户地址</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> amount;              </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 用户账户</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> credit;              </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 用户积分</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        string</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  cardId;              </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 身份证ID</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        string</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  designation;         </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 用户称号</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[] donateList;        </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 捐款记录ID</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[] raiseList;         </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 募资记录ID</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[] welfareList;       </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 公益活动捐赠记录ID</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">   voteCount;         </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 参与投票的次数</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        uint8</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">     withdrawCount;     </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 提现的次数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span></code></pre></div><h4 id="_1-2-机构用户数据结构设计" tabindex="-1">1.2 机构用户数据结构设计 <a class="header-anchor" href="#_1-2-机构用户数据结构设计" aria-label="Permalink to &quot;1.2 机构用户数据结构设计&quot;">​</a></h4><div class="language-solidity vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">solidity</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 机构结构体信息</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> Org</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> orgId;              </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 用户ID</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    string</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  orgName;            </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 用户名称</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    address</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> orgAddress;         </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 用户地址</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> amount;             </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 用户账户</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[] activitiesList;   </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 灾区活动发起记录ID</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><h4 id="_1-3-物流商数据结构设计" tabindex="-1">1.3 物流商数据结构设计 <a class="header-anchor" href="#_1-3-物流商数据结构设计" aria-label="Permalink to &quot;1.3 物流商数据结构设计&quot;">​</a></h4><div class="language-solidity vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">solidity</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 物流商结构体信息</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> Logistic</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> logisticId;              </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 用户ID</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    string</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  logisticName;            </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 用户名称</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    address</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> logisticAddress;         </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 用户地址</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><h3 id="_2-慈善公益活动存储设计" tabindex="-1">2.慈善公益活动存储设计 <a class="header-anchor" href="#_2-慈善公益活动存储设计" aria-label="Permalink to &quot;2.慈善公益活动存储设计&quot;">​</a></h3><h4 id="_2-1-募资活动数据结构设计" tabindex="-1">2.1 募资活动数据结构设计 <a class="header-anchor" href="#_2-1-募资活动数据结构设计" aria-label="Permalink to &quot;2.1 募资活动数据结构设计&quot;">​</a></h4><div class="language-solidity vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">solidity</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    // 公益活动结构体信息</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    // RaiseId =&gt; CharityRaiseFund</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> CharityRaiseFund</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> raiseId;            </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 活动ID</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        string</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  title;              </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 活动名称</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        string</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  desc;               </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 活动描述</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> createTime;         </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 活动创建时间</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        address</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> promoterAddress;    </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 活动组织者</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        uint8</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">   status;             </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 活动状态 1: 投票中 2：募资中 3：结束</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> startTime;          </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 开始时间</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> endTime;            </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 结束时间</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> totalPeople;        </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 总参与人数</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> totalAmount;        </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 总需金额</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> overAmount;         </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 已经完成集资金额</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> withdrawAmount;     </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 已经取出的金额</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    mapping</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">uint256</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) isYesMap;           </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 募资支持的票选结果</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    mapping</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">uint256</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) isNoMap;            </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 募资不支持的票选结果</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    mapping</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">uint256</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> bool</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) isApply;               </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 募资活动是否支持举行</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    mapping</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">uint256</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) CertificateMap;      </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 募资活动上传的证明</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    mapping</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">uint256</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[]) raiseEvaluationsMap;      </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 活动评估 [4,5,4,2,1]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    mapping</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">uint256</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> address</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[]) raisePeoplesMap;          </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 参与人的溯源地址</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    mapping</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">uint256</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[]) raiseDonationTransIdsMap; </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 所有参与人的交易溯源ID</span></span></code></pre></div><h4 id="_2-4-灾区活动数据结构设计" tabindex="-1">2.4 灾区活动数据结构设计 <a class="header-anchor" href="#_2-4-灾区活动数据结构设计" aria-label="Permalink to &quot;2.4 灾区活动数据结构设计&quot;">​</a></h4><div class="language-solidity vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">solidity</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    // 公益捐赠灾区结构体信息</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> CharityActivitie</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> activitId;          </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 活动ID</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        string</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  title;              </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 活动名称</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> createTime;         </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 创建时间</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> startTime;          </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 开始时间</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> endTime;            </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 结束时间</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        string</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  logisticType;       </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 物流方式</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        address</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> logisticAddress;    </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 物流商地址</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        address</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> lncomeAddress;      </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 代理人地址</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        uint8</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">   status;             </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 状态</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> totalPeople;        </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 总参与人数</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> totalMaterias;      </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 总物资数量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    mapping</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">uint256</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[]) activiteEvaluationsMap;      </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 活动评估 [4,5,4,2,1]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    mapping</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">uint256</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> address</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[]) activitePeoplesMap;          </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 参与人的溯源地址</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    mapping</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">uint256</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[]) activiteCharityTransIdsMap;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 所有参与人的交易溯源ID</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    uint256</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> public</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> raiseCount;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    uint256</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> public</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> activiteCount;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    mapping</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">uint256</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">CharityRaiseFund) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">public</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> charityRaiseFundMap;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    mapping</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">uint256</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">CharityActivitie) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">public</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> charityActivitieMap;</span></span></code></pre></div><h3 id="_3-公益溯源存储设计" tabindex="-1">3.公益溯源存储设计 <a class="header-anchor" href="#_3-公益溯源存储设计" aria-label="Permalink to &quot;3.公益溯源存储设计&quot;">​</a></h3><h4 id="_3-1-公益捐款数据结构设计" tabindex="-1">3.1 公益捐款数据结构设计 <a class="header-anchor" href="#_3-1-公益捐款数据结构设计" aria-label="Permalink to &quot;3.1 公益捐款数据结构设计&quot;">​</a></h4><div class="language-solidity vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">solidity</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> donationTraceId;    </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 公益慈善溯源ID</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    address</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> donorAddress;       </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 捐款人地址</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> amount;             </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 捐款金额</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> transTime;          </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 交易时间</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    string</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  transType;          </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 交易类型</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> raiseId;            </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 公益集资活动ID</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    bool</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    isDonation;         </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 交易状态</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    string</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  source;             </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 捐款来源：来源，可以是个人、组织、企业等。</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    string</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  desc;               </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 捐款描述：具体用途，例如救灾、扶贫、医疗救助等。</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    address</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> destAddress;        </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 捐款接收方机构</span></span></code></pre></div><h4 id="_3-2-公益物资捐赠数据结构设计" tabindex="-1">3.2 公益物资捐赠数据结构设计 <a class="header-anchor" href="#_3-2-公益物资捐赠数据结构设计" aria-label="Permalink to &quot;3.2 公益物资捐赠数据结构设计&quot;">​</a></h4><div class="language-solidity vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">solidity</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> charityTraceId;     </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 公益活动溯源ID</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    uint8</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">   materialType;       </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 种类：记录需要派送的物资种类，例如食品、饮用水、医疗用品、衣物等。</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    string</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  materialName;       </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 物资的名称  </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> materialCount;      </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 物资的数量  </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    address</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> sourceAddress;      </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 源地址</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    address</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> logisticAddress;    </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 物流商地址   </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    address</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> destAddress;        </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 目标地址 </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> transTime;          </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 交易时间  </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    bool</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    isSign;             </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 是否签收 </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    uint256</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> activitId;          </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 公益活动ID</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    uint8</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">   status;             </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 溯源状态： 1 开始 2 运输 3 签收</span></span></code></pre></div><h2 id="_5-功能模块规划" tabindex="-1">5.功能模块规划 <a class="header-anchor" href="#_5-功能模块规划" aria-label="Permalink to &quot;5.功能模块规划&quot;">​</a></h2><h3 id="_1-用户模块管理" tabindex="-1">1.用户模块管理 <a class="header-anchor" href="#_1-用户模块管理" aria-label="Permalink to &quot;1.用户模块管理&quot;">​</a></h3><ul><li><strong>用户注册和查询功能</strong>：用户注册链条初始化信息，并添加链条的用户为用户角色，对异常进行返回状态码处理，并添加用户的查询信息功能。</li><li><strong>机构注册和查询功能</strong>：机构注册链条初始化信息，并添加链条的用户为机构角色，对异常进行返回状态码处理，并添加机构的查询信息功能。</li><li><strong>物流商注册和查询功能</strong>：物流商注册链条初始化信息，并添加链条的用户为物流商角色，对异常进行返回状态码处理，并添加物流商的查询信息功能。</li></ul><h3 id="_2-公益活动模块" tabindex="-1">2.公益活动模块 <a class="header-anchor" href="#_2-公益活动模块" aria-label="Permalink to &quot;2.公益活动模块&quot;">​</a></h3><ul><li>**普通用户发起公益募资功能：**用户在当前的平台上发起公益募资的活动，初始化新的募资活动详细的信息，该募资的活动需要统计当前活动的投票数量，如果当前的投票数量大于50%，则该公益活动会进行上链初始化。用户可以进行参加该公益募资的活动。</li><li>**代理机构发起公益物资功能：**代理机构在当前的平台中，根据判断当前的角色用户是否为机构，如果是代理机构可以进行发起向灾区捐赠物资的公益活动，需要初始化当前的公益物资需求信息，然后不需要进行投票，所有的数据初始化上链之后，会对所有的用户参与进行溯源追踪。</li></ul><h3 id="_3-慈善公益模块" tabindex="-1">3.慈善公益模块 <a class="header-anchor" href="#_3-慈善公益模块" aria-label="Permalink to &quot;3.慈善公益模块&quot;">​</a></h3><ul><li>**普通用户进行公益捐赠物资功能：**普通用户进行慈善公益的查询，然后分别对当前开放的公益捐赠物资活动进行选择，然后可以填写需要捐赠的物资信息，以及填写对应的物流商，即可进行捐赠物资，可以查看当前的物资是什么状态，是否被签收，是否退回。</li><li>**普通用户进行公益捐款功能：**普通用户可以进行开放的公益捐款活动中，分别查询需要进行捐款的活动信息，或者是一些认证信息。</li></ul><h3 id="_4-溯源追踪模块" tabindex="-1">4.溯源追踪模块 <a class="header-anchor" href="#_4-溯源追踪模块" aria-label="Permalink to &quot;4.溯源追踪模块&quot;">​</a></h3><blockquote><p>如下的这两个合约中，业务的溯源追踪进行透明公开。</p></blockquote><ul><li>**公益活动的溯源追踪：**一个公益活动对应着多个用户的物资捐赠的交易信息合约上链，再完成这比交易之后，用户的交易信息上链，保存当前用户的合约地址作为查询的索引，该交易的溯源信息可以进行状态的管理，以及对整个生命周期的追溯。</li><li>**公益募资的溯源追踪：**一个公益募资的活动对应着多个用户的捐款订单，也是对每一个用户的捐款交易订单信息进行上链，保存当前用户的合于地址作为查询的索引，该交交易溯源信息可以进行状态的管理，包括个人捐款记录的溯源追踪。</li></ul><h3 id="_5-投票功能模块" tabindex="-1">5.投票功能模块 <a class="header-anchor" href="#_5-投票功能模块" aria-label="Permalink to &quot;5.投票功能模块&quot;">​</a></h3><ul><li>**对募资的公益活动进行票选：**由于公益募资和集资都是个人的行为，需要上传证明以及需要保证当前的公益募资是通过票选的，在规定的时间内完成票选，并且需要大于50才能够进行公益募资。</li><li>**票选通过判断：**到达该时间的结束的时候，可以调用当前的函数进行判断是否票选通过，然后进行是否可以公开当前票选结果，并且允许进行公益捐款的参与。</li></ul><h2 id="_6-合约状态码" tabindex="-1">6.合约状态码 <a class="header-anchor" href="#_6-合约状态码" aria-label="Permalink to &quot;6.合约状态码&quot;">​</a></h2><table><thead><tr><th><strong>状态码</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td>50000</td><td>参数无效</td></tr><tr><td>50001</td><td>订单状态异常</td></tr><tr><td>50002</td><td>公益活动不存在</td></tr><tr><td>50003</td><td>公益募资活动不存在</td></tr><tr><td>70001</td><td>当前的物流商地址不符合</td></tr><tr><td>70002</td><td>当前的签收人地址不符合</td></tr><tr><td>70003</td><td>当前的提现人地址不符合</td></tr><tr><td>70004</td><td>当前的金额大于已完成的金额</td></tr><tr><td>70005</td><td></td></tr><tr><td>60001</td><td>用户已经存在</td></tr><tr><td>60001</td><td>用户不存在</td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr></tbody></table>`,38);function u(s,B,m,E,b,_){const h=k,l=e("ClientOnly");return n(),r("div",null,[D,d(l,null,{default:g(()=>{var i,a;return[(((i=s.$frontmatter)==null?void 0:i.aside)??!0)&&(((a=s.$frontmatter)==null?void 0:a.showArticleMetadata)??!0)?(n(),A(h,{key:0,article:s.$frontmatter},null,8,["article"])):c("",!0)]}),_:1}),F])}const I=p(o,[["render",u]]);export{f as __pageData,I as default};
